<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Map with Leaflet and jQuery</title>
<!-- Panggil pustaka Leaflet dari CDN -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" type="text/css">
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<!-- Panggil jQuery dari CDN -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<style>
    /* Style untuk container peta */
    #map {
        width: 100%;
        height: 400px;
    }
</style>
</head>
<body>
<div id="map"></div>

<!-- Komponen HTML untuk menampilkan Longitude, Latitude, dan Alamat -->
<br>
<div>
    <button id="btn_location" onclick="cek_lokasi_anda()">Cek Lokasi Anda</button>
</div>
<br>
<div>
    <label for="longitude">Longitude:</label>
    <span id="longitude"></span>
</div>
<div>
    <label for="latitude">Latitude:</label>
    <span id="latitude"></span>
</div>
<div>
    <label for="address">Address:</label>
    <span id="address"></span>
</div>


<script>
// Inisialisasi peta menggunakan Leaflet
var map = L.map('map').setView([0, 0], 2);

// Tambahkan layer peta dari OpenStreetMap
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

// Fungsi untuk menambahkan marker ke lokasi yang diberikan
function addMarker(latitude, longitude) {
    L.marker([latitude, longitude]).addTo(map);
}






// Fungsi untuk mendapatkan lokasi saat ini
function getCurrentLocation() {
    // Periksa apakah browser mendukung Geolocation API
    if ("geolocation" in navigator) {
        // Memanggil getCurrentPosition untuk mendapatkan lokasi saat ini
        navigator.geolocation.getCurrentPosition(function(position) {
            // Mendapatkan koordinat latitude dan longitude
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;

            // Tambahkan marker ke lokasi saat ini pada peta
            addMarker(latitude, longitude);

            // Set nilai Longitude, Latitude, dan Address menggunakan jQuery
            $("#longitude").text(longitude);
            $("#latitude").text(latitude);

            // Dapatkan alamat menggunakan fungsi getAddress
            getAddress(latitude, longitude);
            
            // Posisikan peta pada lokasi saat ini
            map.setView([latitude, longitude], 15);
        }, function(error) {
            // Menangani kesalahan jika tidak dapat mendapatkan lokasi
            console.error("Tidak dapat mendapatkan lokasi: " + error.message);
        });
    } else {
        // Menangani jika browser tidak mendukung Geolocation API
        console.error("Geolocation tidak didukung oleh browser ini.");
    }
}

function cek_lokasi_anda(){
    // Panggil fungsi untuk mendapatkan lokasi saat ini
    getCurrentLocation();

}

// Fungsi untuk mendapatkan alamat dari latitude dan longitude
function getAddress(latitude, longitude) {
    // Buat URL untuk panggilan ke Nominatim API
    var url = "https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=" + latitude + "&lon=" + longitude;
    
    // Lakukan panggilan AJAX ke Nominatim API
    $.ajax({
        url: url,
        type: 'GET',
        success: function(data) {
            // Dapatkan alamat dari data dan set nilai input Address menggunakan jQuery
            var address = data.display_name;
            $("#address").text(address);
        },
        error: function(xhr, status, error) {
            // Tampilkan pesan kesalahan jika terjadi masalah
            console.error("Gagal mendapatkan alamat: " + error);
        }
    });
}
</script>
</body>
</html>
